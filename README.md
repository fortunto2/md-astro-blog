# Astro Zettelkasten Blog

SSR-–±–ª–æ–≥ –¥–ª—è –∑–∞–º–µ—Ç–æ–∫ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π wikilinks, R2 —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤.

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **SSR —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥** markdown —Ñ–∞–π–ª–æ–≤ on-the-fly
- **Dual endpoints**: HTML (`/n/[slug]`) –∏ raw markdown (`/n/[slug].md`)
- **Wikilinks**: `[[–∑–∞–º–µ—Ç–∫–∞]]` ‚Üí `/n/–∑–∞–º–µ—Ç–∫–∞`
- **–ü—É–±–ª–∏—á–Ω—ã–π/–ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç** —Å SEO
- **Cloudflare R2** —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- **Edge –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** —á–µ—Ä–µ–∑ Cloudflare Pages

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```text
blog2/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ lib/md.ts           # –û–±—Ä–∞–±–æ—Ç–∫–∞ markdown
‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.astro     # –ì–ª–∞–≤–Ω–∞—è (domain index + header/footer)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ n/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ [...slug].astro    # HTML –∑–∞–º–µ—Ç–∫–∏
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ [...slug].md.ts    # Raw markdown API
‚îú‚îÄ‚îÄ .env                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ CLAUDE.md              # –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üßû –ö–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `pnpm dev` | Dev —Å–µ—Ä–≤–µ—Ä `localhost:4322` |
| `pnpm build` | –°–±–æ—Ä–∫–∞ –≤ `./dist/` |
| `pnpm deploy` | –°–±–æ—Ä–∫–∞ + –¥–µ–ø–ª–æ–π –Ω–∞ Cloudflare |
| `pnpm test` | –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ (30 —Ç–µ—Å—Ç–æ–≤) |
| `pnpm lint` | –õ–∏–Ω—Ç–∏–Ω–≥ —Å –∞–≤—Ç–æ—Ñ–∏–∫—Å–æ–º |
| `pnpm r2:put` | –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –≤ R2 |
| `pnpm r2:delete` | –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –∏–∑ R2 |

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

2. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–∏—Ç—å CDN fallback –≤ `.env` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è R2 –±–∏–Ω–¥–∏–Ω–≥ `BLOG_CONTENT`)
3. –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç: `pnpm r2:put sgr-blog-content/domain/file.md --file ./notes/file.md --remote`

## üåç –ü—Ä–æ–¥–∞–∫—à–µ–Ω

- **Live**: https://<pages-project>.pages.dev
- **R2**: https://content.example.com

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ [CLAUDE.md](./CLAUDE.md)

## üß© Cloudflare bindings

Ensure the Pages project has the following bindings configured:

- R2 bucket: `BLOG_CONTENT` ‚Üí `sgr-blog-content`
- Vectorize index: `VECTOR_INDEX` ‚Üí `autorag-blog-deep`

Without these bindings the worker will return 500 errors when trying to read content.


# –ú—É–ª—å—Ç–∏–¥–æ–º–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

## üéØ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
- –ö–∞–∂–¥—ã–π –¥–æ–º–µ–Ω —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–∏–º –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –∏ —Ñ—É—Ç–µ—Ä–æ–º —á–µ—Ä–µ–∑ `header.md` –∏ `footer.md` –≤ –ø–∞–ø–∫–µ –¥–æ–º–µ–Ω–∞.
- –ò–Ω–¥–µ–∫—Å –¥–æ–º–µ–Ω–∞ –∏—â–µ—Ç—Å—è –ø–æ —Ü–µ–ø–æ—á–∫–µ: `/<domain>/index.md` ‚Üí `/indexes/<basename>.md` ‚Üí –∑–Ω–∞—á–µ–Ω–∏–µ `PUBLIC_INDEX_URL`.
- –ó–∞–º–µ—Ç–∫–∏ –∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–∞–ø–∫–∏ —Ä–µ–∑–æ–ª–≤—è—Ç—Å—è –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ –¥–æ–º–µ–Ω–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π `shared/` –∏ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ fallback.
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ –º–æ–∂–Ω–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –≤ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö –ø–æ–¥–ø–∞–ø–∫–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `private/`) –∏ –∑–∞–∫—Ä—ã—Ç—å –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ Cloudflare Zero Trust.
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (hasH1 detection)
- –ö–æ–Ω—Ç–µ–Ω—Ç —á–∏—Ç–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –±–∏–Ω–¥–∏–Ω–≥ `BLOG_CONTENT`; `PUBLIC_MD_BASES` –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–µ–Ω CDN fallback.
- 30 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤ –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ R2
```
sgr-blog-content/
‚îú‚îÄ‚îÄ domain-a.example/
‚îÇ   ‚îú‚îÄ‚îÄ header.md              # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–º–µ–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ footer.md              # –§—É—Ç–µ—Ä (–ø–æ—á—Ç–∞: info@<maindomain>)
‚îÇ   ‚îú‚îÄ‚îÄ index.md               # –ì–ª–∞–≤–Ω—ã–π MOC –¥–æ–º–µ–Ω–∞
‚îÇ   ‚îî‚îÄ‚îÄ section/               # –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –ø–æ–¥–ø–∞–ø–∫–∏
‚îÇ       ‚îú‚îÄ‚îÄ index.md
‚îÇ       ‚îú‚îÄ‚îÄ topic-a.md
‚îÇ       ‚îî‚îÄ‚îÄ topic-b.md
‚îú‚îÄ‚îÄ domain-b.example/          # –î—Ä—É–≥–∏–µ –¥–æ–º–µ–Ω—ã –æ—Ñ–æ—Ä–º–ª—è—é—Ç—Å—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ
‚îú‚îÄ‚îÄ domain-c.example/
‚îú‚îÄ‚îÄ indexes/                   # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ MOC, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω—É –∏ —Ç—É –∂–µ –∑–∞–º–µ—Ç–∫—É
‚îî‚îÄ‚îÄ (shared/ ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

## üîé –ü–æ–∏—Å–∫ –∑–∞–º–µ—Ç–æ–∫
–ö–æ–≥–¥–∞ –≤–æ—Ä–∫–µ—Ä —Ä–µ–Ω–¥–µ—Ä–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –≤—ã–¥–∞—ë—Ç –∏—Å—Ö–æ–¥–Ω—ã–π Markdown, –æ–Ω –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–±—É–µ—Ç:
1. `<domain>/<slug>.md` - –¥–æ–º–µ–Ω-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π —Ñ–∞–π–ª
2. `shared/<slug>.md` - –æ–±—â–∏–π —Ñ–∞–π–ª
3. `<slug>.md` - legacy —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ
4. –§–æ–ª–±–µ–∫ —á–µ—Ä–µ–∑ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π `/api/r2/<slug>.md`

> –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –≥–∏–±–∫–æ—Å—Ç—å –∏ –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å.

## üß© –ß–∞—Å—Ç–∏—á–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã
- `header.md` –∏ `footer.md` —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–π –∏ –Ω–∞ –∫–∞–∂–¥–æ–π –∑–∞–º–µ—Ç–∫–µ.
- –ï—Å–ª–∏ `footer.md` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –¥–≤–∏–∂–æ–∫ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç email `info@<–æ—Å–Ω–æ–≤–Ω–æ–π-–¥–æ–º–µ–Ω>`.
- –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –∏—Ö –≤—Ä—É—á–Ω—É—é –≤ –∑–∞–º–µ—Ç–∫–∞—Ö.

## üöÄ –°–∫—Ä–∏–ø—Ç—ã –∏ –∫–æ–º–∞–Ω–¥—ã
`package.json` —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
```bash
pnpm dev        # –ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
pnpm build      # —Å–±–æ—Ä–∫–∞
pnpm deploy     # build + wrangler pages deploy dist
pnpm r2:put     # wrangler r2 object put
pnpm r2:delete  # wrangler r2 object delete
```

### –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã —Å R2
```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–º–µ—Ç–∫–∏
pnpm r2:put sgr-blog-content/domain-a.example/section/topic-a.md \
  --file ./content/domain-a/section/topic-a.md --remote

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞/—Ñ—É—Ç–µ—Ä–∞
pnpm r2:put sgr-blog-content/domain-a.example/header.md --file ./header.md --remote
pnpm r2:put sgr-blog-content/domain-a.example/footer.md --file ./footer.md --remote

# –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
pnpm r2:delete sgr-blog-content/domain-a.example/draft-note.md --remote
```

## üõ† –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–æ–≤–æ–≥–æ –¥–æ–º–µ–Ω–∞
1. –î–æ–±–∞–≤–∏—Ç—å CNAME –≤ Cloudflare Pages.
2. –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É –≤ –±–∞–∫–µ—Ç–µ: `sgr-blog-content/<domain>/`.
3. –ó–∞–≥—Ä—É–∑–∏—Ç—å `header.md`, `footer.md`, `index.md` –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏.
4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –æ–±—â–∏–π MOC –≤ `indexes/` –∏ —Å–æ—Å–ª–∞—Ç—å—Å—è –Ω–∞ –Ω–µ–≥–æ —á–µ—Ä–µ–∑ `PUBLIC_INDEX_URL`.
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `https://<domain>/` –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–º–µ—Ç–æ–∫ (`/n/<slug>` –∏ `/n/<slug>.md`).

## üîí –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
- –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–¥–ø–∞–ø–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `domain-a.example/private/`) –∏ –≤ –Ω–µ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π `index.md`.
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ Cloudflare Zero Trust –∏–ª–∏ –∏–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞.
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –≤–∏–¥–∞ `/n/private/report` –ø—Ä–æ–¥–æ–ª–∂–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## üß© –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–æ–º–µ–Ω–∞
- –ì–ª–∞–≤–Ω—ã–π MOC: `domain-a.example/index.md`
- –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–¥–µ–ª: `domain-a.example/section/index.md`
- –ü–æ–¥–∑–∞–ø–∏—Å–∫–∏: `domain-a.example/section/topic-a.md`, `domain-a.example/section/topic-b.md`
- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ñ—É—Ç–µ—Ä: `domain-a.example/header.md`, `domain-a.example/footer.md`

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –∫–∞–∫ —à–∞–±–ª–æ–Ω –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤.

## ‚ú® –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ H1 –≤ –Ω–∞—á–∞–ª–µ markdown –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `# –ó–∞–≥–æ–ª–æ–≤–æ–∫`, —Ç–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–∑ frontmatter –Ω–µ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è
- –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- –°–≤–æ–π—Å—Ç–≤–æ `hasH1` –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ `Note` –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —ç—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- **30 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤** –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –¢–µ—Å—Ç—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è H1, –æ–±—Ä–∞–±–æ—Ç–∫–∏ wikilinks, domain routing
- –ó–∞–ø—É—Å–∫: `pnpm test` –∏–ª–∏ `pnpm test:run`
- –õ–∏–Ω—Ç–∏–Ω–≥: `pnpm lint` —Å –∞–≤—Ç–æ—Ñ–∏–∫—Å–æ–º —á–µ—Ä–µ–∑ `pnpm lint:fix`
- Husky + lint-staged –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –∫–æ–º–º–∏—Ç–∞—Ö
